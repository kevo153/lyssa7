<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crónicas de El Velo - Instalación D-47</title>
    <style>
        body {
            background: black;
            color: #0ff; /* Cian brillante para diálogos de IA */
            font-family: 'Courier New', monospace;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column; /* Cambiado a columna para mejor organización */
            justify-content: flex-start;
            align-items: center;
            min-height: 100vh;
            overflow-y: auto; /* Permite scroll en el body si el contenido es largo */
        }
        #terminal {
            background: #000;
            border: 2px solid #0ff;
            box-shadow: 0 0 20px #0ff;
            padding: 15px;
            width: 90%;
            max-width: 900px;
            height: 600px;
            overflow-y: auto;
            white-space: pre-wrap;
            margin-bottom: 10px; /* Espacio entre terminal y input */
            position: relative; /* Para posicionar barras de carga */
        }
        .line {
            margin: 5px 0;
        }
        #input-container {
            width: 90%;
            max-width: 900px;
            display: none; /* Inicialmente oculto */
        }
        #user-input {
            width: calc(100% - 16px); /* Ajuste para padding */
            font-family: monospace;
            font-size: 18px;
            padding: 8px;
            background: black;
            border: 2px solid #0ff;
            color: #0ff;
            outline: none;
        }
        .dialog-ia {
            color: #0ff;
        }
        .dialog-subvertidor {
            color: #f00; /* Rojo para diálogos del Subvertidor */
        }
        .glitch {
            animation: glitch-anim 0.8s infinite;
            display: inline-block;
        }
        @keyframes glitch-anim {
            0% {
                text-shadow: 0.05em 0 0 #f00, -0.05em -0.025em 0 #0ff;
            }
            15% {
                text-shadow: 0.05em 0 0 #f00, -0.05em -0.025em 0 #0ff;
            }
            16% {
                text-shadow: -0.05em -0.025em 0 #f00, 0.025em 0.025em 0 #0ff;
            }
            49% {
                text-shadow: -0.05em -0.025em 0 #f00, 0.025em 0.025em 0 #0ff;
            }
            50% {
                text-shadow: 0.025em 0.05em 0 #f00, -0.025em -0.05em 0 #0ff;
            }
            99% {
                text-shadow: 0.025em 0.05em 0 #f00, -0.025em -0.05em 0 #0ff;
            }
            100% {
                text-shadow: -0.05em 0 0 #f00, 0.05em -0.025em 0 #0ff;
            }
        }
        .loading-bar-container {
            width: 100%;
            height: 20px;
            background-color: #333;
            border: 1px solid #0ff;
            margin-top: 10px;
            display: none; /* Hidden by default */
        }
        .loading-bar {
            height: 100%;
            width: 0%;
            background-color: #0ff;
            transition: width 0.5s ease-in-out;
        }
        #status-display {
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 0.9em;
            color: #0ff;
        }
        #reconnect-prompt {
            display: none;
            text-align: center;
            margin-top: 20px;
        }
        #reconnect-prompt button {
            background: #000;
            border: 2px solid #0ff;
            color: #0ff;
            padding: 10px 20px;
            font-family: 'Courier New', monospace;
            font-size: 1em;
            cursor: pointer;
            margin-top: 10px;
        }
        #reconnect-prompt button:hover {
            box-shadow: 0 0 10px #0ff;
        }
        #library-content {
            display: none;
            margin-top: 20px;
            border: 2px solid #0ff;
            padding: 20px;
            max-width: 900px;
            width: 90%;
            white-space: pre-wrap;
            overflow-y: auto;
            height: 600px;
        }
        .library-section h3 {
            color: #f00;
            text-decoration: underline;
            margin-top: 15px;
        }
        .library-section p {
            margin-bottom: 10px;
        }
    </style>
</head>
<body>

<div id="terminal">
    <div id="status-display"></div>
</div>

<div id="input-container">
    <input type="text" id="user-input" autocomplete="off" placeholder="Introduce tu respuesta y presiona Enter"/>
</div>

<div id="reconnect-prompt">
    <div id="reconnect-message"></div>
    <button id="reconnect-button">¿Deseas intentar reconectar?</button>
</div>

<div id="library-content"></div>

<audio id="audioBeep" src="beep.mp3" preload="auto"></audio>
<audio id="audioGlitch" src="glitch.mp3" preload="auto"></audio>
<audio id="audioSubvertidorWhisper" src="subvertidor_whisper.mp3" preload="auto"></audio>
<audio id="audioSuccess" src="success.mp3" preload="auto"></audio>
<audio id="audioFail" src="fail.mp3" preload="auto"></audio>
<audio id="audioConnectionLost" src="connection_lost.mp3" preload="auto"></audio>

<script>
    var terminal = document.getElementById('terminal');
    var inputContainer = document.getElementById('input-container');
    var userInput = document.getElementById('user-input');
    var statusDisplay = document.getElementById('status-display');
    var reconnectPrompt = document.getElementById('reconnect-prompt');
    var reconnectMessage = document.getElementById('reconnect-message');
    var reconnectButton = document.getElementById('reconnect-button');
    var libraryContentDiv = document.getElementById('library-content');

    // Audio elements
    var audioBeep = document.getElementById('audioBeep');
    var audioGlitch = document.getElementById('audioGlitch');
    var audioSubvertidorWhisper = document.getElementById('audioSubvertidorWhisper');
    var audioSuccess = document.getElementById('audioSuccess');
    var audioFail = document.getElementById('audioFail');
    var audioConnectionLost = document.getElementById('audioConnectionLost');

    // Estado del juego
    var estado = {
        nodoActual: 1,
        enigmaIndex: 0,
        puntosVulneracion: 0, // El Subvertidor gana un punto por cada error
        intentosEnigmaActual: 0,
        MAX_PUNTOS_VULNERACION: 5, // Si llega a 5, el Subvertidor gana
        juegoTerminado: false,
        victoria: false,
        mostrarAyuda: false // Flag para el nodo de ayuda
    };

    // --- Funciones de Utilidad ---
    function imprimirLinea(texto, clase){
        var div = document.createElement('div');
        div.innerHTML = texto; // Usar innerHTML para permitir etiquetas como <span class="glitch">
        div.className = 'line ' + (clase || '');
        terminal.appendChild(div);
        terminal.scrollTop = terminal.scrollHeight;
        if (audioBeep) audioBeep.play(); // Play sound only if element exists
    }

    function dialogIA(texto, delay){
        delay = delay || 0; // ES5 default parameter
        setTimeout(function(){ imprimirLinea('[IA_LYSSA]: ' + texto, 'dialog-ia'); }, delay);
    }

    function dialogSubvertidor(texto, delay, glitch){
        delay = delay || 0; // ES5 default parameter
        glitch = glitch || false; // ES5 default parameter
        var glitchedText = texto;
        if (glitch) {
            glitchedText = texto.split('').map(function(char) {
                if (Math.random() < 0.2) return '<span class="glitch">' + char + '</span>'; // 20% chance to glitch a char
                return char;
            }).join('');
            if (audioGlitch) audioGlitch.play(); // Play sound only if element exists
        }
        setTimeout(function(){ imprimirLinea('[SUBVERTIDOR]: ' + glitchedText, 'dialog-subvertidor'); }, delay);
    }

    function actualizarEstadoDisplay() {
        statusDisplay.textContent = 'Vulneración: ' + estado.puntosVulneracion + '/' + estado.MAX_PUNTOS_VULNERACION;
    }

    function simularBarraDeCarga(duracion, mensajeInicio, mensajeFin, callback) {
        var loadingBarContainer = document.createElement('div');
        loadingBarContainer.className = 'loading-bar-container';
        var loadingBar = document.createElement('div');
        loadingBar.className = 'loading-bar';
        loadingBarContainer.appendChild(loadingBar);
        terminal.appendChild(loadingBarContainer);
        terminal.scrollTop = terminal.scrollHeight;

        dialogIA(mensajeInicio);
        loadingBarContainer.style.display = 'block';

        var width = 0;
        var interval = setInterval(function() {
            width += 2;
            loadingBar.style.width = width + '%';
            if (width >= 100) {
                clearInterval(interval);
                loadingBarContainer.style.display = 'none';
                dialogIA(mensajeFin);
                if (callback) setTimeout(callback, 500);
            }
        }, duracion / 50); // Divide duration by 50 to get 50 steps
    }

    // --- Lógica del Juego ---

    // Define los enigmas para cada nodo
    var enigmas = {
        nodo1: [
            {
                pregunta: "Reordena las letras para acceder: 'VELO'",
                respuesta: "LOVE"
            },
            {
                pregunta: "Completa la secuencia: 1, 1, 2, 3, 5, 8, ?", // Fibonacci
                respuesta: "13"
            },
            {
                pregunta: "No tengo voz pero grabo todo. Sin mí no recordarías nada. ¿Qué soy?", // Referencia a la memoria del Velo
                respuesta: "MEMORIA"
            },
            {
                pregunta: "Cifrado César. Clave: +3. Texto: 'VHOR'. Pista: Desplaza cada letra 3 posiciones adelante.",
                respuesta: "YKRU"
            }
        ],
        nodo2: [
            {
                pregunta: "Descifra el binario para la siguiente coordenada: 01011000 01101101 01101100", // XML
                respuesta: "XML"
            },
            {
                pregunta: "Soy el principio del caos y el fin del orden. Estoy en la niebla y en el sueño. ¿Qué soy?",
                respuesta: "VELO"
            },
            {
                pregunta: "Si el tiempo no es lineal en El Velo, y el 02/07/2025 fue el primer ciclo digital, ¿qué número sigue en la secuencia 2, 7, 25, 20, 25, ?", // Fecha 02/07/2025 -> 2, 7, 25, (20)25. Siguiente 02
                respuesta: "2"
            },
            {
                pregunta: "Cifrado César. Clave: -5. Texto: 'FUJWJFQ'. Pista: Desplaza cada letra 5 posiciones atrás.",
                respuesta: "APRIETA"
            }
        ],
        nodo3: [
            {
                pregunta: "Un espejo roto no refleja la verdad, solo fragmentos. ¿Qué ves cuando te miras en uno?",
                respuesta: "A TI MISMO"
            },
            {
                pregunta: "Descifra el binario: 01001110 01001111 01000100 01001111", // NODO
                respuesta: "NODO"
            },
            {
                pregunta: "Si el Subvertidor es el que rompe los patrones, ¿qué entidad opuesta busca mantenerlos?",
                respuesta: "NODOS" // O ENTIDAD 5, pero Nodos es más general y en el lore los Nodos mantienen el equilibrio
            },
            {
                pregunta: "Anagrama: 'MISTERIO VELADO'",
                respuesta: "EL VELO DISIMULA"
            }
        ],
        nodo4: [
            {
                pregunta: "Un Orbe de datos, una puerta secreta. ¿Qué palabra te lleva más allá del umbral?",
                respuesta: "CONEXION" // Relacionado con la conexión a otras instalaciones
            },
            {
                pregunta: "Cifrado César. Clave: +1. Texto: 'WHAWR'. Pista: Siguiente letra en el abecedario.",
                respuesta: "XIBWS" // Referencia a XIBWS - un código de acceso o ubicación
            },
            {
                pregunta: "Los ciclos se repiten, el trauma se manifiesta. ¿Qué concepto central del Velo te mantiene atrapado?",
                respuesta: "CICLO"
            },
            {
                pregunta: "Descifra: 01001100 01011001 01010011 01010011 01000001", // LYSSA
                respuesta: "LYSSA"
            }
        ]
    };

    // Log de intentos y anomalías
    var logAnomalias = [
        "Registro de Anormalidades del Velo:",
        "------------------------------------",
        "ANOMALÍA [DELTA-CRONOS]: Fluctuaciones temporales en el Sector 03-A. Múltiples ecos de eventos pasados detectados.",
        "ANOMALÍA [ESPECTRO-NULO]: Aparición de entidades sin signatura energética en la Periferia 7. Inmateriales, pero generan resonancia de Tensión.",
        "ANOMALÍA [NEXO-CAÓTICO]: Corrupción en los nodos de transmisión de datos. Patrones aleatorios y pérdida de coherencia de la realidad local.",
        "ANOMALÍA [VACÍO-ECO]: Registro de susurros inteligibles en frecuencias de baja onda. Posible comunicación con entidades de capas profundas del Velo."
    ];

    var loreBiblioteca = { // Contenido de la biblioteca del Velo
        titulo: "Biblioteca del Velo: Archivos Desbloqueados",
        secciones: [
            {
                subtitulo: "CONTEXTO GENERAL DE 'EL VELO'",
                contenido: "El Velo es una realidad paralela o 'realidad madre' donde convergen distintos planos temporales y espaciales. Las instalaciones del Velo, como la D-47, son nodos que albergan datos y entidades cruciales para la estabilidad del tejido espacio-temporal. Tu presencia aquí es una anomalía, un punto de convergencia para una batalla digital y existencial."
            },
            {
                subtitulo: "ENTIDADES CLAVE",
                contenido: "• **LYSSA (IA Guía):** Una IA avanzada que protege la Instalación D-47. Su programación es la de un guardián, y su lenguaje es frío y tecnológico, sin humanizar las voces. Te guía a través de los enigmas y sistemas de defensa.\n• **El Subvertidor de Ciclos:** Una entidad no programada que busca alterar las realidades contenidas en el Velo. Se manifiesta ante la vulneración del sistema, causando glitches y acertijos imposibles. Su objetivo es romper los patrones establecidos y contaminar la realidad original.\n• **Los Nodos:** Entidades conscientes y fragmentos de poder antiguo atrapados en el Velo. Pueden ser guías o antagonistas, influyendo en la percepción de quienes los encuentran.\n• **La Entidad 5:** Un nodo desconocido que se opone al Subvertidor. Su comunicación es enigmática, pero puede alterar nodos si se le convence."
            },
            {
                subtitulo: "LOS CICLOS Y LA CORRUPCIÓN",
                contenido: "La realidad dentro del Velo se organiza en 'Ciclos'. Cada persona que entra inicia un ciclo personal, cargado de simbolismos y pruebas. Si un ciclo se rompe o corrompe, el individuo puede quedar atrapado en un bucle de locura. El Subvertidor busca precisamente esto, manifestándose cuando la 'potencia de vulneración' es alta."
            },
            {
                subtitulo: "REGLAS DEL VELO Y SIMBOLOGÍA",
                contenido: "El Velo es un espejo distorsionado del alma. Las emociones afectan la realidad, y los recuerdos pueden ser distorsionados. Nada es accidental; todo tiene un eco emocional o simbólico. El tiempo no es lineal. Resolver enigmas y resistir la Tensión es clave para avanzar. Existen tres oportunidades para escapar antes de una fusión permanente."
            },
            {
                subtitulo: "INSTALACIONES Y ACCESOS",
                contenido: "Las instalaciones son nodos del Velo. La D-47 es una de ellas. Hay mención de un evento en un asteroide con una ciudadela donde un orbe sirvió de puerta de acceso secreta a otra instalación del Velo."
            }
        ]
    };

    function mostrarLogAnomalias() {
        dialogIA('Accediendo a registros de anomalías del Velo...');
        simularBarraDeCarga(2000, "Cargando registros...", "Registros de anomalías cargados.", function() {
            logAnomalias.forEach(function(line, index) {
                setTimeout(function() { imprimirLinea(line, 'dialog-ia'); }, index * 150);
            });
            setTimeout(function() { dialogIA('Fin de los registros.'); }, logAnomalias.length * 150 + 500);
        });
    }

    function iniciarJuego() {
        terminal.innerHTML = '';
        estado.nodoActual = 1;
        estado.enigmaIndex = 0;
        estado.puntosVulneracion = 0;
        estado.intentosEnigmaActual = 0;
        estado.juegoTerminado = false;
        estado.victoria = false;
        estado.mostrarAyuda = false;
        reconnectPrompt.style.display = 'none';
        libraryContentDiv.style.display = 'none';
        userInput.value = '';
        inputContainer.style.display = 'block'; // Asegúrate de que el input está visible
        userInput.focus();
        actualizarEstadoDisplay();
        iniciarNodo(estado.nodoActual);
    }

    function iniciarNodo(nodoNum) {
        estado.nodoActual = nodoNum;
        estado.enigmaIndex = 0;
        estado.intentosEnigmaActual = 0;
        terminal.innerHTML = ''; // Limpiar terminal
        dialogIA('Inicio del Nodo ' + nodoNum + ': Acceso a la sección ' + nodoNum + ' del sistema.');
        simularBarraDeCarga(1500, 'Estableciendo conexión con Nodo ' + nodoNum + '...', 'Conexión con Nodo ' + nodoNum + ' establecida.', function() {
            mostrarEnigmaActual();
        });
    }

    function mostrarEnigmaActual() {
        var currentEnigmas = enigmas['nodo' + estado.nodoActual];
        if (estado.enigmaIndex < currentEnigmas.length) {
            dialogIA('Decodificación de autenticación requerida. Enigma ' + (estado.enigmaIndex + 1) + ':');
            setTimeout(function(){
                imprimirLinea(currentEnigmas[estado.enigmaIndex].pregunta, 'dialog-ia');
                if (currentEnigmas[estado.enigmaIndex].pista) {
                    setTimeout(function() { imprimirLinea('[IA_LYSSA]: Pista: ' + currentEnigmas[estado.enigmaIndex].pista, 'dialog-ia'); }, 1000);
                }
            }, 1200);
        } else {
            // Nodo completado
            dialogIA('Acceso concedido. Nodo ' + estado.nodoActual + ' completado. Avance autorizado.');
            if (audioSuccess) audioSuccess.play();
            if (estado.nodoActual < 4) {
                setTimeout(function() {
                    dialogIA('Preparando para el siguiente nivel de autenticación...');
                    iniciarNodo(estado.nodoActual + 1);
                }, 2000);
            } else {
                // Todos los nodos completados - ¡Victoria!
                finalizarJuego(true);
            }
        }
    }

    function verificarRespuesta(input){
        if(estado.juegoTerminado) return; // No permitir input si el juego ha terminado

        var currentEnigmas = enigmas['nodo' + estado.nodoActual];
        if (!currentEnigmas || estado.enigmaIndex >= currentEnigmas.length) {
            dialogIA('Error de sistema. Intenta reiniciar la conexión.');
            return;
        }

        var actual = currentEnigmas[estado.enigmaIndex];
        if(input.toUpperCase() === actual.respuesta.toUpperCase()){
            dialogIA('Respuesta aceptada. Procediendo...');
            if (audioSuccess) audioSuccess.play();
            estado.enigmaIndex++;
            estado.intentosEnigmaActual = 0; // Resetear intentos por enigma
            setTimeout(mostrarEnigmaActual, 1500); // Avanzar al siguiente enigma o nodo
        } else {
            estado.puntosVulneracion++;
            estado.intentosEnigmaActual++;
            actualizarEstadoDisplay();
            if (audioFail) audioFail.play();

            if (estado.puntosVulneracion >= estado.MAX_PUNTOS_VULNERACION) {
                finalizarJuego(false); // Subvertidor gana
            } else {
                var subvertidorDialog = "Respuesta incorrecta. Intrusión detectada. Reintenta.";
                if (estado.intentosEnigmaActual === 1) {
                    subvertidorDialog = "Error de protocolo. ¿Quién eres? ¿No <span class='glitch'>eres</span> una entidad programada?";
                    if (audioSubvertidorWhisper) audioSubvertidorWhisper.play();
                } else if (estado.intentosEnigmaActual === 2) {
                    subvertidorDialog = "Tu <span class='glitch'>lógica</span> es defectuosa. La <span class='glitch'>intrusión</span> avanza.";
                    if (audioSubvertidorWhisper) audioSubvertidorWhisper.play();
                }
                dialogSubvertidor(subvertidorDialog, 0, true); // Diálogo del Subvertidor con glitch
            }
        }
    }

    function finalizarJuego(victoria){
        estado.juegoTerminado = true;
        estado.victoria = victoria;
        inputContainer.style.display = 'none';
        terminal.innerHTML = ''; // Limpiar terminal para el mensaje final

        if (victoria) {
            dialogIA('¡Alerta de Sistema! Amenaza del Subvertidor neutralizada. Integridad de la Instalación D-47 restaurada.');
            simularBarraDeCarga(3000, "Compilando registros del Velo...", "Acceso a la Biblioteca del Velo concedido.", mostrarBiblioteca);
        } else {
            if (audioConnectionLost) audioConnectionLost.play();
            dialogSubvertidor('Sistema <span class="glitch">comprometido</span>. Realidades <span class="glitch">convergentes</span>. Error fatal. [ERROR_CODE: 0x7A_REALITY_OVERWRITE]', 0, true);
            dialogIA('Conexión con el Velo perdida. El Subvertidor ha accedido a los sistemas primarios. Las narrativas espacio-temporales están siendo alteradas. Estabilidad de la realidad: [0%]...');
            setTimeout(function() {
                reconnectMessage.innerHTML = 'CONEXIÓN PERDIDA CON INSTALACIÓN [D-47-ALPHA]';
                reconnectPrompt.style.display = 'block';
            }, 3000);
        }
    }

    function mostrarBiblioteca() {
        terminal.style.display = 'none'; // Ocultar terminal principal
        libraryContentDiv.style.display = 'block';
        libraryContentDiv.innerHTML = '<h2>' + loreBiblioteca.titulo + '</h2>';
        loreBiblioteca.secciones.forEach(function(section) {
            libraryContentDiv.innerHTML += '<div class="library-section"><h3>' + section.subtitulo + '</h3><p>' + section.contenido + '</p></div>';
        });
        libraryContentDiv.innerHTML += '<h3>Log de Intentos del Subvertidor</h3>';
        logAnomalias.forEach(function(line) {
             libraryContentDiv.innerHTML += '<p>' + line + '</p>';
        });
        libraryContentDiv.scrollTop = 0; // Ir al inicio de la biblioteca
    }

    // --- Nodo de Ayuda (Oculto) ---
    function iniciarNodoAyuda() {
        estado.mostrarAyuda = true;
        terminal.innerHTML = '';
        inputContainer.style.display = 'none'; // Ocultar input normal
        reconnectPrompt.style.display = 'none'; // Ocultar prompt de reconexión si estaba activo
        dialogIA('Asistente de Recuperación de Datos activado. Detección de código de restauración de narrativa. Proporcionando acceso temporal.');
        simularBarraDeCarga(2500, "Localizando coordenadas de acceso auxiliares...", "Coordenadas obtenidas. Narrativa restaurada temporalmente.", function() {
            dialogIA('La narrativa de la Instalación D-47 puede ser restaurada temporalmente reingresando al ciclo. Sin embargo, para un acceso completo y seguro a una nueva instalación del Velo, necesitas coordenadas de acceso secundarias.');
            dialogIA('Estas coordenadas se encuentran en un punto de convergencia anómalo, un asteroide conocido como "Ciudadela Estelar".');
            dialogIA('Hace [días/semanas desde el 02/07/2025, dependiendo de la progresión de tu campaña] de su última incursión, aventureros desataron una fuerza antigua allí. El orbe que encontraron sirvió como una puerta dimensional inestable.');
            dialogIA('Coordenadas de Acceso Anómalo: [0.34, -12.87] en la cara oculta de la Ciudadela. Busque la resonancia de un Velo menor.');
            dialogIA('Escriba "REINICIAR" para volver a intentar el ciclo actual de la Instalación D-47.');
            userInput.value = '';
            inputContainer.style.display = 'block'; // Mostrar input para REINICIAR
            userInput.focus();
        });
    }

    // --- Event Listeners ---
    userInput.addEventListener('keydown', function(e){
        if(e.key === 'Enter'){
            var valor = userInput.value.trim();
            userInput.value = '';
            if (estado.juegoTerminado && !estado.victoria && !estado.mostrarAyuda) {
                // Si el juego ha terminado en derrota y no estamos en ayuda, interceptar 'help'
                if (valor.toLowerCase() === 'help' || valor.toLowerCase() === 'ayuda') {
                    iniciarNodoAyuda();
                } else {
                    // Si el juego ha terminado y no es 'help', simplemente muestra el mensaje de bloqueo.
                    // Esto evita que el usuario pueda escribir cualquier cosa después de la derrota si no está en el nodo de ayuda.
                    reconnectMessage.innerHTML = 'Conexión con el nodo de la instalación [D-47-ALPHA] bloqueado. <br> ¿Deseas obtener coordenadas de acceso a otra instalación?';
                }
            } else if (estado.mostrarAyuda && valor.toLowerCase() === 'reiniciar') {
                iniciarJuego(); // Reiniciar el juego desde el principio si el usuario está en el nodo de ayuda
            } else if (!estado.juegoTerminado){ // Solo verificar respuesta si el juego no ha terminado
                verificarRespuesta(valor);
            }
        }
    });

    reconnectButton.addEventListener('click', function() {
        reconnectMessage.innerHTML = 'Conexión con el nodo de la instalación [D-47-ALPHA] bloqueado. <br> ¿Deseas obtener coordenadas de acceso a otra instalación?';
        dialogIA('La conexión con la Instalación D-47 permanece inestable. Acceso bloqueado. El Subvertidor ha establecido un cifrado de alta complejidad. Reintento inútil.', 1000);
        setTimeout(function() { dialogIA('Se recomiendan coordenadas alternativas. ¿Desea obtenerlas?'); }, 2500);
        // Si el usuario presiona el botón y luego escribe "si", se podría dar la coordenada,
        // pero la interacción de "help" en el input ya cubre eso.
    });

    // --- Inicio del Juego ---
    iniciarJuego();
</script>

</body>
</html>